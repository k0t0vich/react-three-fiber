{"version":3,"sources":["../../src/canvas.tsx","../../src/targets/shared/web/ResizeContainer.tsx","../../src/index.ts","../../src/hooks.ts","resources/shaders/DigitalGlitch.js","resources/postprocessing/GlitchPass.js","resources/shaders/WaterShader.js","resources/postprocessing/WaterPass.js","demo/utils.js","demo/Model.js","demo/Demo.js","styles.js","Demo.js","index.js","../../src/targets/web.tsx","../../src/renderer.tsx"],"names":["isOrthographicCamera","def","makeId","event","eventObject","object","uuid","index","stateContext","createContext","useCanvas","props","children","gl","camera","orthographic","raycaster","size","pixelRatio","vr","concurrent","shadowMap","colorManagement","invalidateFrameloop","updateDefaultCamera","noEvents","onCreated","onPointerMissed","forceResize","useState","ready","setReady","THREE","mouse","ray","filter","computeOffsets","raycasterProps","applyProps","defaultRaycaster","scene","__interaction","__objects","defaultScene","cam","position","z","lookAt","defaultCam","setDefaultCamera","clock","state","useRef","active","manual","frames","aspect","subscribers","viewport","initialClick","initialHits","pointer","TinyEmitter","captured","undefined","events","subscribe","ref","priority","current","push","sort","a","b","s","invalidate","intersect","prepare","handlePointerMove","getCurrentViewport","useCallback","target","width","height","distance","distanceTo","zoom","factor","fov","Math","PI","h","tan","w","useMemo","Object","assign","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","hovered","Map","temp","prepareRay","offsets","nativeEvent","offsetX","offsetY","set","setFromCamera","seen","Set","hits","eventsObjects","intersects","intersectObjects","item","id","has","add","sharedState","__handlers","parent","calculateDistance","dx","dy","round","sqrt","handlePointerCancel","emit","Array","from","values","forEach","data","length","find","i","handlers","delete","pointerOut","type","pointerLeave","getIntersects","intersections","hit","handleIntersects","fn","unprojectedPoint","x","y","unproject","delta","releasePointerCapture","localState","stopped","setPointerCapture","raycastEvent","stopPropagation","cap","currentTarget","sourceEvent","objects","obj","some","name","pointerOver","pointerEnter","hoveredItem","get","pointerMove","handlePointer","includes","map","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCaptureLegacy","onLostPointerCapture","useLayoutEffect","isArray","setPixelRatio","max","min","window","devicePixelRatio","enabled","toneMapping","outputEncoding","Canvas","activate","useEffect","result","then","render","Provider","value","xr","setAnimationLoop","t","renderGl","console","warn","renderLists","dispose","forceContextLoss","unmountComponentAtNode","p","defaultStyles","overflow","Content","setEvents","container","renderer","effects","ResizeContainer","React","memo","webgl1","preRender","resize","style","restSpread","containerRef","useMeasure","scroll","debounce","polyfill","ResizeObserver","bind","readyFlag","mergeRefs","useContext","context","useContextImpl","useFrame","callback","renderPriority","unsubscribe","useThree","loadingFn","extensions","onProgress","Proto","url","loader","urlArray","Promise","all","res","reject","load","nodes","materials","traverse","material","error","message","useLoader","results","useAsset","preload","DigitalGlitch","uniforms","tDiffuse","tDisp","byp","amount","angle","seed","seed_x","seed_y","distortion_x","distortion_y","col_s","vertexShader","join","fragmentShader","GlitchPass","dt_size","Pass","call","this","shader","UniformsUtils","clone","generateHeightmap","ShaderMaterial","OrthographicCamera","Scene","quad","Mesh","PlaneBufferGeometry","frustumCulled","prototype","create","constructor","writeBuffer","readBuffer","deltaTime","maskActive","texture","random","_Math","randFloat","renderToScreen","setRenderTarget","clear","data_arr","Float32Array","val","DataTexture","RGBFormat","FloatType","needsUpdate","WaterShader","tex","time","resolution","WaterPass","Vector2","getMouseDegrees","degreeLimit","innerWidth","innerHeight","moveJoint","joint","degrees","rotation","xD","lerp","yD","degToRad","Model","group","GLTFLoader","animations","actions","mixer","update","idle","clipAction","play","clip","uncacheClip","mixamorigNeck","mixamorigSpine","receiveShadow","castShadoow","geometry","skeleton","map-flipY","skinning","extend","EffectComposer","ShaderPass","RenderPass","UnrealBloomPass","FilmPass","halfPi","Swarm","count","mesh","dummy","particles","r","zLen","speed","sin","cos","particle","scale","updateMatrix","setMatrixAt","matrix","instanceMatrix","args","attach","color","roughness","metalness","Effect","down","composer","attachArray","App","clientX","clientY","onMouseMove","getMousePos","onMouseUp","onMouseDown","intensity","fallback","Page","styled","div","Global","createGlobalStyle","ReactDOM","document","getElementById","canvasRef","WebGL1Renderer","WebGLRenderer","params","antialias","alpha","powerPreference","canvas","display","roots","emptyObject","is","arr","fun","str","num","und","equ","globalEffects","globalAfterEffects","globalTailEffects","timestamp","repeat","runGlobalEffects","getDelta","running","renderLoop","root","containerInfo","__state","requestAnimationFrame","catalogue","instance","newProps","oldProps","accumulative","__container","sameProps","keys","startsWith","leftOvers","toFilter","__instance","filteredProps","indexOf","filteredPropsEntries","entries","key","split","reduce","acc","reverse","isColorManagement","copy","convertSRGBToLinear","encoding","invalidateInstance","raycast","splice","charAt","toLowerCase","substr","updateInstance","onUpdate","createInstance","hostContext","internalInstanceHandle","toUpperCase","slice","__dispose","node","return","stateNode","endsWith","appendChild","parentInstance","child","isObject3D","attachObject","insertBefore","beforeChild","dispatchEvent","restSiblings","sibling","removeRecursive","array","removeChild","remove","run","idlePriority","switchInstance","fiber","newInstance","alternate","Renderer","Reconciler","now","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","preparePortalMount","resetAfterCommit","shouldSetTextContent","clearContainer","Symbol","for","element","newRoot","createContainer","updateContainer","getPublicRootInstance","injectIntoDevTools","bundleType","findHostInstanceByFiber","version","rendererPackageName"],"mappings":"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","file":"static/js/main.9fdea18f.chunk.js","sourcesContent":["import * as THREE from 'three'\nimport React, { useMemo, useRef, useEffect, useState, useCallback, createContext, useLayoutEffect } from 'react'\nimport { render, invalidate, applyProps, unmountComponentAtNode, renderGl } from './renderer'\nimport { TinyEmitter } from 'tiny-emitter'\nimport { NamedArrayTuple, ReactThreeFiber } from './three-types'\nimport { RectReadOnly } from 'react-use-measure'\n\nexport type Camera = THREE.OrthographicCamera | THREE.PerspectiveCamera\n\nexport function isOrthographicCamera(def: THREE.Camera): def is THREE.OrthographicCamera {\n  return (def as THREE.OrthographicCamera).isOrthographicCamera\n}\n\nexport interface Intersection extends THREE.Intersection {\n  eventObject: THREE.Object3D\n}\n\ntype ThreeEvent<T> = T &\n  Intersection & {\n    intersections: Intersection[]\n    stopped: boolean\n    unprojectedPoint: THREE.Vector3\n    ray: THREE.Ray\n    camera: Camera\n    stopPropagation: () => void\n    sourceEvent: T\n    delta: number\n  }\n\nexport type PointerEvent = ThreeEvent<React.PointerEvent>\nexport type MouseEvent = ThreeEvent<React.MouseEvent>\nexport type WheelEvent = ThreeEvent<React.WheelEvent>\n\ntype DomEvent = PointerEvent | MouseEvent | WheelEvent\n\nexport type RenderCallback = (state: CanvasContext, delta: number) => void\n\nexport type Viewport = { width: number; height: number; factor: number; distance: number }\nexport type ViewportData = Viewport & ((camera: Camera, target: THREE.Vector3) => Viewport)\n\nexport type SharedCanvasContext = {\n  gl: THREE.WebGLRenderer\n  aspect: number\n  subscribe: (callback: React.MutableRefObject<RenderCallback>, priority?: number) => () => void\n  setDefaultCamera: (camera: Camera) => void\n  invalidate: () => void\n  intersect: (event?: DomEvent) => void\n  camera: Camera\n  raycaster: THREE.Raycaster\n  mouse: THREE.Vector2\n  clock: THREE.Clock\n  scene: THREE.Scene\n  size: RectReadOnly\n  viewport: ViewportData\n  events: DomEventHandlers\n  forceResize: () => void\n}\n\nexport type Subscription = {\n  ref: React.MutableRefObject<RenderCallback>\n  priority: number\n}\n\nexport type CanvasContext = SharedCanvasContext & {\n  captured: Intersection[] | undefined\n  noEvents: boolean\n  ready: boolean\n  active: boolean\n  manual: number\n  colorManagement: boolean\n  vr: boolean\n  concurrent: boolean\n  invalidateFrameloop: boolean\n  frames: number\n  subscribers: Subscription[]\n  initialClick: NamedArrayTuple<(x: number, y: number) => void>\n  initialHits: THREE.Object3D[]\n  pointer: TinyEmitter\n}\n\nexport type FilterFunction = (items: THREE.Intersection[], state: SharedCanvasContext) => THREE.Intersection[]\nexport type ComputeOffsetsFunction = (event: DomEvent) => { offsetX: number; offsetY: number }\n\nexport type ResizeOptions = {\n  debounce?: number | { scroll: number; resize: number }\n  scroll?: boolean\n}\n\nexport interface CanvasProps {\n  children: React.ReactNode\n  vr?: boolean\n  webgl1?: boolean\n  concurrent?: boolean\n  shadowMap?: boolean | Partial<THREE.WebGLShadowMap>\n  colorManagement?: boolean\n  orthographic?: boolean\n  resize?: ResizeOptions\n  invalidateFrameloop?: boolean\n  updateDefaultCamera?: boolean\n  noEvents?: boolean\n  gl?: Partial<THREE.WebGLRendererParameters>\n  camera?: Partial<\n    ReactThreeFiber.Object3DNode<THREE.Camera, typeof THREE.Camera> &\n      ReactThreeFiber.Object3DNode<THREE.PerspectiveCamera, typeof THREE.PerspectiveCamera> &\n      ReactThreeFiber.Object3DNode<THREE.OrthographicCamera, typeof THREE.OrthographicCamera>\n  >\n  raycaster?: Partial<THREE.Raycaster> & { filter?: FilterFunction; computeOffsets?: ComputeOffsetsFunction }\n  pixelRatio?: number | [number, number]\n  onCreated?: (props: CanvasContext) => Promise<any> | void\n  onPointerMissed?: () => void\n}\n\nexport interface UseCanvasProps extends CanvasProps {\n  gl: THREE.WebGLRenderer\n  size: RectReadOnly\n  forceResize: () => void\n}\n\nexport type DomEventHandlers = {\n  onClick(e: any): void\n  onContextMenu(e: any): void\n  onDoubleClick(e: any): void\n  onWheel(e: any): void\n  onPointerDown(e: any): void\n  onPointerUp(e: any): void\n  onPointerLeave(e: any): void\n  onPointerMove(e: any): void\n  onGotPointerCaptureLegacy(e: any): void\n  onLostPointerCapture(e: any): void\n}\n\nfunction makeId(event: DomEvent) {\n  return (event.eventObject || event.object).uuid + '/' + event.index\n}\n\nexport const stateContext = createContext<SharedCanvasContext>({} as SharedCanvasContext)\n\nexport const useCanvas = (props: UseCanvasProps): DomEventHandlers => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    concurrent = false,\n    shadowMap = false,\n    colorManagement = true,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed,\n    forceResize,\n  } = props\n\n  // Local, reactive state\n  const [ready, setReady] = useState(false)\n  const [mouse] = useState(() => new THREE.Vector2())\n\n  const [defaultRaycaster] = useState(() => {\n    const ray = new THREE.Raycaster()\n    if (raycaster) {\n      const { filter, computeOffsets, ...raycasterProps } = raycaster\n      applyProps(ray, raycasterProps, {})\n    }\n    return ray\n  })\n\n  const [defaultScene] = useState(() => {\n    const scene = new THREE.Scene()\n    ;(scene as any).__interaction = []\n    ;(scene as any).__objects = []\n    return scene\n  })\n\n  const [defaultCam, setDefaultCamera] = useState(() => {\n    const cam = orthographic\n      ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000)\n      : new THREE.PerspectiveCamera(75, 0, 0.1, 1000)\n    cam.position.z = 5\n    if (camera) applyProps(cam, camera, {})\n    // Always look at [0, 0, 0]\n    cam.lookAt(0, 0, 0)\n    return cam\n  })\n\n  const [clock] = useState(() => new THREE.Clock())\n\n  // Public state\n  const state: React.MutableRefObject<CanvasContext> = useRef<CanvasContext>({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement,\n    vr,\n    concurrent,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: (null as unknown) as ViewportData,\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: (undefined as unknown) as DomEventHandlers,\n\n    subscribe: (ref: React.MutableRefObject<RenderCallback>, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++\n\n      state.current.subscribers.push({ ref, priority: priority })\n      // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority)\n      return () => {\n        if (state.current?.subscribers) {\n          // Decrease manual flag if this subscription had a priority\n          if (priority) state.current.manual--\n          state.current.subscribers = state.current.subscribers.filter((s) => s.ref !== ref)\n        }\n      }\n    },\n    setDefaultCamera: (camera: Camera) => setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: (event: DomEvent | undefined = {} as DomEvent, prepare = true) => handlePointerMove(event, prepare),\n    forceResize,\n  })\n\n  const getCurrentViewport = useCallback(\n    (camera: Camera = state.current.camera, target: THREE.Vector3 = new THREE.Vector3(0, 0, 0)) => {\n      const { width, height } = state.current.size\n      const distance = camera.position.distanceTo(target)\n      if (isOrthographicCamera(camera)) {\n        return { width: width / camera.zoom, height: height / camera.zoom, factor: 1, distance }\n      } else {\n        const fov = (camera.fov * Math.PI) / 180 // convert vertical fov to radians\n        const h = 2 * Math.tan(fov / 2) * distance // visible height\n        const w = h * (width / height)\n        return { width: w, height: h, factor: width / w, distance }\n      }\n    },\n    []\n  )\n\n  // Writes locals into public state for distribution among subscribers, context, etc\n  useMemo(() => {\n    state.current.ready = ready\n    state.current.size = size\n    state.current.camera = defaultCam\n    state.current.invalidateFrameloop = invalidateFrameloop\n    state.current.vr = vr\n    state.current.gl = gl\n    state.current.concurrent = concurrent\n    state.current.noEvents = noEvents\n    // Make viewport backwards compatible\n    state.current.viewport = getCurrentViewport as ViewportData\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl])\n\n  // Adjusts default camera\n  useMemo(() => {\n    state.current.aspect = size.width / size.height\n    // Assign viewport props to the function\n    Object.assign(state.current.viewport, getCurrentViewport())\n\n    // https://github.com/drcmda/react-three-fiber/issues/92\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2\n        defaultCam.right = size.width / 2\n        defaultCam.top = size.height / 2\n        defaultCam.bottom = size.height / -2\n      } else {\n        defaultCam.aspect = state.current.aspect\n      }\n      defaultCam.updateProjectionMatrix()\n\n      // https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n      defaultCam.updateMatrixWorld()\n    }\n\n    gl.setSize(size.width, size.height)\n\n    if (ready) invalidate(state)\n  }, [defaultCam, gl, size, updateDefaultCamera])\n\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  const hovered = useMemo(() => new Map<string, DomEvent>(), [])\n  const temp = new THREE.Vector3()\n\n  /** Sets up defaultRaycaster */\n  const prepareRay = useCallback((event: DomEvent) => {\n    // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n    const offsets = raycaster?.computeOffsets?.(event) || event.nativeEvent\n    if (offsets) {\n      const { offsetX, offsetY } = offsets\n      const { width, height } = state.current.size\n      mouse.set((offsetX / width) * 2 - 1, -(offsetY / height) * 2 + 1)\n      defaultRaycaster.setFromCamera(mouse, state.current.camera)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  /** Intersects interaction objects using the event input */\n  const intersect = useCallback(\n    (event: DomEvent, filter?: (objects: THREE.Object3D[]) => THREE.Object3D[]): Intersection[] => {\n      // Skip event handling when noEvents is set\n      if (state.current.noEvents) return []\n\n      const seen = new Set<string>()\n      const hits: Intersection[] = []\n\n      // Allow callers to eliminate event objects\n      const eventsObjects = filter\n        ? filter((state.current.scene as any).__interaction)\n        : (state.current.scene as any).__interaction\n\n      // Intersect known handler objects and filter against duplicates\n      let intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter((item) => {\n        const id = makeId(item as DomEvent)\n        if (seen.has(id)) return false\n        seen.add(id)\n        return true\n      })\n\n      // https://github.com/mrdoob/three.js/issues/16031\n      // Allow custom userland intersect sort order\n      if (raycaster && raycaster.filter && sharedState.current) {\n        intersects = raycaster.filter(intersects, sharedState.current)\n      }\n\n      for (const intersect of intersects) {\n        let eventObject: THREE.Object3D | null = intersect.object\n        // Bubble event up\n        while (eventObject) {\n          const handlers = (eventObject as any).__handlers\n          if (handlers) hits.push({ ...intersect, eventObject })\n          eventObject = eventObject.parent\n        }\n      }\n      return hits\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  )\n\n  /**  Calculates click deltas */\n  const calculateDistance = useCallback((event: DomEvent) => {\n    const dx = event.nativeEvent.offsetX - state.current.initialClick[0]\n    const dy = event.nativeEvent.offsetY - state.current.initialClick[1]\n    return Math.round(Math.sqrt(dx * dx + dy * dy))\n  }, [])\n\n  const handlePointerCancel: any = useCallback((event: DomEvent, hits?: Intersection[], prepare = true) => {\n    state.current.pointer.emit('pointerCancel', event)\n    if (prepare) prepareRay(event)\n    // commenting this out as I believe it is unneccessary and causes a recursive dependency\n    // if (!hits) hits = handleIntersects(event, () => null)\n    Array.from(hovered.values()).forEach((data) => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find((i) => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject\n        const handlers = (eventObject as any).__handlers\n        hovered.delete(makeId(data))\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut({ ...data, type: 'pointerout' })\n          if (handlers.pointerLeave) handlers.pointerLeave({ ...data, type: 'pointerleave' })\n        }\n      }\n    })\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  /**  Creates filtered intersects and returns an array of positive hits */\n  const getIntersects = useCallback(\n    (event: DomEvent, filter?: (objects: THREE.Object3D[]) => THREE.Object3D[]): Intersection[] => {\n      // Get fresh intersects\n      const intersections: Intersection[] = intersect(event, filter)\n      // If the interaction is captured take that into account, the captured event has to be part of the intersects\n      if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n        state.current.captured.forEach((captured) => {\n          if (!intersections.find((hit) => hit.eventObject === captured.eventObject)) intersections.push(captured)\n        })\n      }\n      return intersections\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  )\n\n  /**  Handles intersections by forwarding them to handlers */\n  const handleIntersects = useCallback(\n    (intersections: Intersection[], event: DomEvent, fn: (event: DomEvent) => void): Intersection[] => {\n      // If anything has been found, forward it to the event listeners\n      if (intersections.length) {\n        const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera)\n        const delta = event.type === 'click' ? calculateDistance(event) : 0\n        const releasePointerCapture = (id: any) => (event.target as any).releasePointerCapture(id)\n        const localState = { stopped: false, captured: false }\n\n        for (const hit of intersections) {\n          const setPointerCapture = (id: any) => {\n            // If the hit is going to be captured flag that we're in captured state\n            if (!localState.captured) {\n              localState.captured = true\n              // The captured hit array is reset to collect hits\n              state.current.captured = []\n            }\n            // Push hits to the array\n            if (state.current.captured) {\n              state.current.captured.push(hit)\n            }\n            // Call the original event now\n            ;(event.target as any).setPointerCapture(id)\n          }\n\n          const raycastEvent = {\n            ...event,\n            ...hit,\n            intersections,\n            stopped: localState.stopped,\n            delta,\n            unprojectedPoint,\n            ray: defaultRaycaster.ray,\n            camera: state.current.camera,\n            // Hijack stopPropagation, which just sets a flag\n            stopPropagation: () => {\n              // https://github.com/react-spring/react-three-fiber/issues/596\n              // Events are not allowed to stop propagation if the pointer has been captured\n              const cap = state.current.captured\n              if (!cap || cap.find((h) => h.eventObject.id === hit.eventObject.id)) {\n                raycastEvent.stopped = localState.stopped = true\n                // Propagation is stopped, remove all other hover records\n                // An event handler is only allowed to flush other handlers if it is hovered itself\n                if (hovered.size && Array.from(hovered.values()).find((i) => i.object === hit.object))\n                  handlePointerCancel(raycastEvent, [hit])\n              }\n            },\n            target: { ...event.target, setPointerCapture, releasePointerCapture },\n            currentTarget: { ...event.currentTarget, setPointerCapture, releasePointerCapture },\n            sourceEvent: event,\n          }\n\n          fn(raycastEvent)\n\n          // Event bubbling may be interrupted by stopPropagation\n          if (localState.stopped === true) break\n        }\n      }\n      return intersections\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  )\n\n  const handlePointerMove = useCallback((event: DomEvent, prepare = true) => {\n    state.current.pointer.emit('pointerMove', event)\n    if (prepare) prepareRay(event)\n    const hits = getIntersects(\n      event,\n      // This is onPointerMove, we're only interested in events that exhibit this particular event\n      (objects: any) =>\n        objects.filter((obj: any) =>\n          ['Move', 'Over', 'Enter', 'Out', 'Leave'].some((name) => (obj as any).__handlers['pointer' + name])\n        )\n    )\n\n    // Take care of unhover\n    handlePointerCancel(event, hits)\n    handleIntersects(hits, event, (data: any) => {\n      const eventObject = data.eventObject\n      const handlers = (eventObject as any).__handlers\n      // Check presence of handlers\n      if (!handlers) return\n      // Check if mouse enter or out is present\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data)\n        const hoveredItem = hovered.get(id)\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data)\n          if (handlers.pointerOver) handlers.pointerOver({ ...data, type: 'pointerover' })\n          if (handlers.pointerEnter) handlers.pointerEnter({ ...data, type: 'pointerenter' })\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation()\n        }\n      }\n      // Call mouse move\n      if (handlers.pointerMove) handlers.pointerMove(data)\n    })\n    return hits\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const handlePointer = useCallback(\n    (name: string) => (event: DomEvent, prepare = true) => {\n      state.current.pointer.emit(name, event)\n      if (prepare) prepareRay(event)\n      const hits = getIntersects(event)\n      handleIntersects(hits, event, (data: any) => {\n        const eventObject = data.eventObject\n        const handlers = (eventObject as any).__handlers\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click events,\n          // which must use the initial target\n          if (\n            (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick') ||\n            state.current.initialHits.includes(eventObject)\n          ) {\n            handlers[name](data)\n          }\n        }\n      })\n      // If a click yields no results, pass it back to the user as a miss\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.nativeEvent.offsetX, event.nativeEvent.offsetY]\n        state.current.initialHits = hits.map((hit: any) => hit.eventObject)\n      }\n\n      if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length && onPointerMissed) {\n        if (calculateDistance(event) <= 2) onPointerMissed()\n      }\n    },\n    [onPointerMissed, calculateDistance, getIntersects, handleIntersects, prepareRay]\n  )\n\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: (e: any) => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: (e: any) => (state.current.captured = intersect(e)),\n      onLostPointerCapture: (e: any) => ((state.current.captured = undefined), handlePointerCancel(e)),\n    }\n  }, [handlePointer, intersect, handlePointerCancel, handlePointerMove])\n\n  /** Events ------------------------------------------------------------------------------------------------- */\n\n  // Only trigger the context provider when necessary\n  const sharedState = useRef<SharedCanvasContext>()\n  useMemo(() => {\n    const {\n      ready,\n      manual,\n      vr,\n      noEvents,\n      invalidateFrameloop,\n      frames,\n      subscribers,\n      captured,\n      initialClick,\n      initialHits,\n      ...props\n    } = state.current\n    sharedState.current = props\n  }, [size, defaultCam])\n\n  // Update pixel ratio\n  useLayoutEffect(() => {\n    if (pixelRatio) {\n      if (Array.isArray(pixelRatio))\n        gl.setPixelRatio(Math.max(Math.min(pixelRatio[0], window.devicePixelRatio), pixelRatio[1]))\n      else gl.setPixelRatio(pixelRatio)\n    }\n  }, [gl, pixelRatio])\n  // Update shadow map\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap)\n      else gl.shadowMap.type = THREE.PCFSoftShadowMap\n    }\n    if (colorManagement) {\n      gl.toneMapping = THREE.ACESFilmicToneMapping\n      gl.outputEncoding = THREE.sRGBEncoding\n    }\n  }, [shadowMap, colorManagement])\n\n  // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n  const Canvas = useCallback(function Canvas(props: { children: React.ReactElement }): JSX.Element {\n    const activate = () => setReady(true)\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current)\n      return void (result && result.then ? result.then(activate) : activate())\n    }, [])\n\n    return props.children\n  }, [])\n\n  // Render v-dom into scene\n  useLayoutEffect(() => {\n    render(\n      <Canvas>\n        <stateContext.Provider value={sharedState.current as SharedCanvasContext}>\n          {typeof children === 'function' ? children(state.current) : children}\n        </stateContext.Provider>\n      </Canvas>,\n      defaultScene,\n      state\n    )\n  }, [ready, children, sharedState.current])\n\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state)\n      } else if (((gl as any).xr || gl.vr) && gl.setAnimationLoop) {\n        ;((gl as any).xr || gl.vr).enabled = true\n        gl.setAnimationLoop((t: number) => renderGl(state, t, 0, true))\n      } else {\n        console.warn('the gl instance does not support VR!')\n      }\n    }\n  }, [ready, invalidateFrameloop])\n\n  // Dispose renderer on unmount\n  useEffect(\n    () => () => {\n      if (state.current.gl) {\n        if (state.current.gl.renderLists) state.current.gl.renderLists.dispose()\n        if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss()\n        dispose((state.current as any).gl)\n      }\n      unmountComponentAtNode(state.current.scene, () => {\n        dispose(state.current.raycaster)\n        dispose(state.current.camera)\n        dispose(state.current)\n      })\n    },\n    []\n  )\n  return state.current.events\n}\n\nfunction dispose(obj: any) {\n  if (obj.dispose) obj.dispose()\n  for (const p in obj) {\n    if (typeof p === 'object' && (p as any).dispose) (p as any).dispose()\n    delete obj[p]\n  }\n}\n","import { WebGLRenderer, Renderer as ThreeRenderer } from 'three'\nimport React, { useRef, useState, useMemo, useEffect } from 'react'\nimport useMeasure, { RectReadOnly } from 'react-use-measure'\nimport { ResizeObserver } from '@juggle/resize-observer'\nimport mergeRefs from 'react-merge-refs'\nimport { useCanvas, CanvasProps, DomEventHandlers } from '../../../canvas'\n\nconst defaultStyles: React.CSSProperties = { position: 'relative', width: '100%', height: '100%', overflow: 'hidden' }\n\ninterface Renderer extends Omit<ThreeRenderer, 'domElement'> {}\n\nexport interface ContainerProps extends CanvasProps, React.HTMLAttributes<HTMLDivElement> {\n  children: React.ReactNode\n}\n\nexport interface ResizeContainerProps extends CanvasProps, ContainerProps {\n  renderer: () => Renderer | undefined | null\n  effects?: (renderer: any, parent: HTMLDivElement) => () => any\n  preRender?: React.ReactNode\n}\n\ninterface ResizeContainerState {\n  size: RectReadOnly\n  forceResize: () => void\n  setEvents: React.Dispatch<React.SetStateAction<DomEventHandlers>>\n  container: HTMLDivElement\n}\n\ninterface ContentProps extends ResizeContainerProps, ResizeContainerState {}\n\nfunction Content({ children, setEvents, container, renderer, effects, ...props }: ContentProps) {\n  // Create renderer\n  const [gl] = useState(renderer)\n  if (!gl) console.warn('No renderer created!')\n\n  // Mount and unmount management\n  useEffect(() => {\n    if (effects) effects(gl, container)\n  }, [container, effects, gl])\n\n  // Init canvas, fetch events, hand them back to the wrapping div\n  const events = useCanvas({ ...props, children, gl: (gl as unknown) as WebGLRenderer })\n  useEffect(() => {\n    setEvents(events)\n  }, [events, setEvents])\n  return null\n}\n\nconst ResizeContainer = React.memo(function ResizeContainer(props: ResizeContainerProps) {\n  const {\n    renderer,\n    effects,\n    children,\n    vr,\n    webgl1,\n    concurrent,\n    shadowMap,\n    colorManagement,\n    orthographic,\n    invalidateFrameloop,\n    updateDefaultCamera,\n    noEvents,\n    gl,\n    camera,\n    raycaster,\n    pixelRatio,\n    onCreated,\n    onPointerMissed,\n    preRender,\n    resize,\n    style,\n    ...restSpread\n  } = props\n\n  const containerRef = useRef<HTMLDivElement>()\n  // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n  const [{ onGotPointerCaptureLegacy, ...events }, setEvents] = useState<DomEventHandlers>({} as DomEventHandlers)\n  const [bind, size, forceResize] = useMeasure(\n    resize || {\n      scroll: true,\n      debounce: { scroll: 50, resize: 0 },\n      polyfill: typeof window === 'undefined' || !(window as any).ResizeObserver ? ResizeObserver : undefined,\n    }\n  )\n\n  // Flag view ready once it's been measured out\n  const readyFlag = useRef(false)\n  const ready = useMemo(() => (readyFlag.current = readyFlag.current || (!!size.width && !!size.height)), [size])\n  const state = useMemo(() => ({ size, forceResize, setEvents, container: containerRef.current as HTMLDivElement }), [\n    forceResize,\n    size,\n  ])\n\n  // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n  if (typeof window === 'undefined')\n    return (\n      <div style={{ ...defaultStyles, ...style }} {...restSpread}>\n        {preRender}\n      </div>\n    )\n\n  // Render the canvas into the dom\n  return (\n    <div ref={mergeRefs([bind, containerRef])} style={{ ...defaultStyles, ...style }} {...events} {...restSpread}>\n      {preRender}\n      {ready && <Content {...props} {...state} />}\n    </div>\n  )\n})\n\nexport { ResizeContainer }\n","export * from './renderer'\nexport * from './three-types'\nexport * from './hooks'\n","import * as THREE from 'three'\nimport { useRef, useContext as useContextImpl, useEffect, useLayoutEffect, useMemo, useState } from 'react'\nimport { SharedCanvasContext, RenderCallback, stateContext } from './canvas'\nimport { useAsset } from 'use-asset'\n\nfunction useContext<T>(context: React.Context<T>) {\n  let result = useContextImpl(context)\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks')\n  }\n  return result\n}\n\nexport function useFrame(callback: RenderCallback, renderPriority: number = 0): null {\n  const { subscribe } = useContext(stateContext)\n  // Update ref\n  const ref = useRef<RenderCallback>(callback)\n  useLayoutEffect(() => void (ref.current = callback), [callback])\n  // Subscribe/unsub\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority)\n    return () => unsubscribe()\n  }, [renderPriority, subscribe])\n  return null\n}\n\nexport function useThree(): SharedCanvasContext {\n  return useContext(stateContext)\n}\n\nexport function useUpdate<T>(\n  callback: (props: T) => void,\n  dependents: any[],\n  optionalRef?: React.MutableRefObject<T>\n): React.MutableRefObject<T> | React.MutableRefObject<undefined> {\n  const { invalidate } = useContext(stateContext)\n  const localRef = useRef()\n  const ref = optionalRef ? optionalRef : localRef\n  useLayoutEffect(() => {\n    if (ref.current) {\n      callback(ref.current)\n      invalidate()\n    }\n  }, dependents) // eslint-disable-line react-hooks/exhaustive-deps\n  return ref\n}\n\nexport function useResource<T>(optionalRef?: React.MutableRefObject<T>): React.MutableRefObject<T> {\n  const [_, forceUpdate] = useState(false)\n  const localRef = useRef<T>((undefined as unknown) as T)\n  const ref = optionalRef ? optionalRef : localRef\n  useLayoutEffect(() => void forceUpdate((i) => !i), [])\n  return ref\n}\n\nexport interface Loader<T> extends THREE.Loader {\n  load(\n    url: string,\n    onLoad?: (result: T) => void,\n    onProgress?: (event: ProgressEvent) => void,\n    onError?: (event: ErrorEvent) => void\n  ): unknown\n}\n\ntype Extensions = (loader: THREE.Loader) => void\ntype LoaderResult<T> = T extends any[] ? Loader<T[number]> : Loader<T>\n\nfunction loadingFn<T>(extensions?: Extensions, onProgress?: (event: ProgressEvent<EventTarget>) => void) {\n  return function (Proto: new () => LoaderResult<T>, url: string[] | string) {\n    // Construct new loader and run extensions\n    const loader = new Proto()\n    if (extensions) extensions(loader)\n    // Go through the urls and load them\n    const urlArray = Array.isArray(url) ? url : [url]\n    return Promise.all(\n      urlArray.map(\n        (url: any) =>\n          new Promise((res, reject) =>\n            loader.load(\n              url,\n              (data: any) => {\n                if (data.scene) {\n                  data.nodes = {}\n                  data.materials = {}\n                  data.scene.traverse((obj: any) => {\n                    if (obj.name) data.nodes[obj.name] = obj\n                    if (obj.material && !data.materials[obj.material.name])\n                      data.materials[obj.material.name] = obj.material\n                  })\n                }\n                res(data)\n              },\n              onProgress,\n              (error) => reject(error.message)\n            )\n          )\n      )\n    )\n  }\n}\n\nexport function useLoader<T>(\n  Proto: new () => LoaderResult<T>,\n  url: T extends any[] ? string[] : string,\n  extensions?: Extensions,\n  onProgress?: (event: ProgressEvent<EventTarget>) => void\n): T {\n  // Use suspense to load async assets\n  const results = useAsset(loadingFn<T>(extensions, onProgress), [Proto, url])\n  // Return the object/s\n  return Array.isArray(url) ? results : results[0]\n}\n\nuseLoader.preload = function <T>(\n  Proto: new () => LoaderResult<T>,\n  url: T extends any[] ? string[] : string,\n  extensions?: Extensions\n) {\n  return useAsset.preload(loadingFn<T>(extensions), Proto, url)\n}\n","/**\n * @author felixturner / http://airtight.cc/\n *\n * RGB Shift Shader\n * Shifts red and blue channels from center in opposite directions\n * Ported from http://kriss.cx/tom/2009/05/rgb-shift/\n * by Tom Butterworth / http://kriss.cx/tom/\n *\n * amount: shift distance (1 is width of input)\n * angle: shift angle in radians\n */\n\nvar DigitalGlitch = {\n  uniforms: {\n    tDiffuse: { value: null }, //diffuse texture\n    tDisp: { value: null }, //displacement texture for digital glitch squares\n    byp: { value: 0 }, //apply the glitch ?\n    amount: { value: 0.08 },\n    angle: { value: 0.02 },\n    seed: { value: 0.02 },\n    seed_x: { value: 0.02 }, //-1,1\n    seed_y: { value: 0.02 }, //-1,1\n    distortion_x: { value: 0.5 },\n    distortion_y: { value: 0.6 },\n    col_s: { value: 0.05 },\n  },\n\n  vertexShader: [\n    'varying vec2 vUv;',\n    'void main() {',\n    'vUv = uv;',\n    'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n    '}',\n  ].join('\\n'),\n\n  fragmentShader: [\n    'uniform int byp;', //should we apply the glitch ?\n    'uniform sampler2D tDiffuse;',\n    'uniform sampler2D tDisp;',\n    'uniform float amount;',\n    'uniform float angle;',\n    'uniform float seed;',\n    'uniform float seed_x;',\n    'uniform float seed_y;',\n    'uniform float distortion_x;',\n    'uniform float distortion_y;',\n    'uniform float col_s;',\n    'varying vec2 vUv;',\n    'float rand(vec2 co){',\n    'return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);',\n    '}',\n    'void main() {',\n    'if(byp<1) {',\n    'vec2 p = vUv;',\n    'float xs = floor(gl_FragCoord.x / 0.5);',\n    'float ys = floor(gl_FragCoord.y / 0.5);',\n    //based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch\n    'vec4 normal = texture2D (tDisp, p*seed*seed);',\n    'if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {',\n    'if(seed_x>0.){',\n    'p.y = 1. - (p.y + distortion_y);',\n    '}',\n    'else {',\n    'p.y = distortion_y;',\n    '}',\n    '}',\n    'if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {',\n    'if(seed_y>0.){',\n    'p.x=distortion_x;',\n    '}',\n    'else {',\n    'p.x = 1. - (p.x + distortion_x);',\n    '}',\n    '}',\n    'p.x+=normal.x*seed_x*(seed/5.);',\n    'p.y+=normal.y*seed_y*(seed/5.);',\n    //base from RGB shift shader\n    'vec2 offset = amount * vec2( cos(angle), sin(angle));',\n    'vec4 cr = texture2D(tDiffuse, p + offset);',\n    'vec4 cga = texture2D(tDiffuse, p);',\n    'vec4 cb = texture2D(tDiffuse, p - offset);',\n    'gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);',\n    //add noise\n    'vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.05);',\n    'gl_FragColor = gl_FragColor+ snow;',\n    '}',\n    'else {',\n    'gl_FragColor=texture2D (tDiffuse, vUv);',\n    '}',\n    '}',\n  ].join('\\n'),\n}\n\nexport { DigitalGlitch }\n","import {\n  DataTexture,\n  FloatType,\n  Math as _Math,\n  Mesh,\n  OrthographicCamera,\n  PlaneBufferGeometry,\n  RGBFormat,\n  Scene,\n  ShaderMaterial,\n  UniformsUtils,\n} from 'three'\nimport { DigitalGlitch } from '../shaders/DigitalGlitch.js'\nimport { Pass } from 'three/examples/jsm/postprocessing/Pass.js'\n/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nvar GlitchPass = function (dt_size) {\n  Pass.call(this)\n  if (DigitalGlitch === undefined) console.error('THREE.GlitchPass relies on THREE.DigitalGlitch')\n  var shader = DigitalGlitch\n  this.uniforms = UniformsUtils.clone(shader.uniforms)\n  if (dt_size === undefined) dt_size = 64\n  this.uniforms['tDisp'].value = this.generateHeightmap(dt_size)\n  this.material = new ShaderMaterial({\n    uniforms: this.uniforms,\n    vertexShader: shader.vertexShader,\n    fragmentShader: shader.fragmentShader,\n  })\n  this.camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1)\n  this.scene = new Scene()\n  this.quad = new Mesh(new PlaneBufferGeometry(2, 2), null)\n  this.quad.frustumCulled = false // Avoid getting clipped\n  this.scene.add(this.quad)\n  this.factor = 0\n}\n\nGlitchPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: GlitchPass,\n\n  render: function (renderer, writeBuffer, readBuffer, deltaTime, maskActive) {\n    const factor = Math.max(0, this.factor)\n    this.uniforms['tDiffuse'].value = readBuffer.texture\n    this.uniforms['seed'].value = Math.random() * factor //default seeding\n    this.uniforms['byp'].value = 0\n    if (factor) {\n      this.uniforms['amount'].value = (Math.random() / 90) * factor\n      this.uniforms['angle'].value = _Math.randFloat(-Math.PI, Math.PI) * factor\n      this.uniforms['distortion_x'].value = _Math.randFloat(0, 1) * factor\n      this.uniforms['distortion_y'].value = _Math.randFloat(0, 1) * factor\n      this.uniforms['seed_x'].value = _Math.randFloat(-0.3, 0.3) * factor\n      this.uniforms['seed_y'].value = _Math.randFloat(-0.3, 0.3) * factor\n    } else this.uniforms['byp'].value = 1\n    this.quad.material = this.material\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null)\n      renderer.render(this.scene, this.camera)\n    } else {\n      renderer.setRenderTarget(writeBuffer)\n      if (this.clear) renderer.clear()\n      renderer.render(this.scene, this.camera)\n    }\n  },\n\n  generateHeightmap: function (dt_size) {\n    var data_arr = new Float32Array(dt_size * dt_size * 3)\n    var length = dt_size * dt_size\n\n    for (var i = 0; i < length; i++) {\n      var val = _Math.randFloat(0, 1)\n      data_arr[i * 3 + 0] = val\n      data_arr[i * 3 + 1] = val\n      data_arr[i * 3 + 2] = val\n    }\n\n    var texture = new DataTexture(data_arr, dt_size, dt_size, RGBFormat, FloatType)\n    texture.needsUpdate = true\n    return texture\n  },\n})\n\nexport { GlitchPass }\n","/**\n * Simple underwater shader\n * \n \n parameters:\n tDiffuse: texture\n time: this should increase with time passing\n distort_speed: how fast you want the distortion effect of water to proceed\n distortion: to what degree will the shader distort the screen \n centerX: the distortion center X coord\n centerY: the distortion center Y coord\n\n explaination:\n the shader is quite simple\n it chooses a center and start from there make pixels around it to \"swell\" then \"shrink\" then \"swell\"...\n this is of course nothing really similar to underwater scene\n but you can combine several this shaders together to create the effect you need...\n And yes, this shader could be used for something other than underwater effect, for example, magnifier effect :)\n\n * @author vergil Wang\n */\n\nvar WaterShader = {\n  uniforms: {\n    byp: { value: 0 }, //apply the glitch ?\n    tex: { type: 't', value: null },\n    time: { type: 'f', value: 0.0 },\n    factor: { type: 'f', value: 0.0 },\n    resolution: { type: 'v2', value: null },\n  },\n\n  vertexShader: [\n    `varying vec2 vUv;\n    void main(){  \n      vUv = uv; \n      vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n      gl_Position = projectionMatrix * modelViewPosition;\n    }`,\n  ].join('\\n'),\n\n  fragmentShader: [\n    `uniform int byp; //should we apply the glitch ?\n    uniform float time;\n    uniform float factor;\n    uniform vec2 resolution;\n    uniform sampler2D tex;\n    \n    varying vec2 vUv;\n    \n    void main() {  \n      if (byp<1) {\n        vec2 uv1 = vUv;\n        vec2 uv = gl_FragCoord.xy/resolution.xy;\n        float frequency = 6.0;\n        float amplitude = 0.015 * factor;\n        float x = uv1.y * frequency + time * .7; \n        float y = uv1.x * frequency + time * .3;\n        uv1.x += cos(x+y) * amplitude * cos(y);\n        uv1.y += sin(x-y) * amplitude * cos(y);\n        vec4 rgba = texture2D(tex, uv1);\n        gl_FragColor = rgba;\n      } else {\n        gl_FragColor = texture2D(tex, vUv);\n      }\n    }`,\n  ].join('\\n'),\n}\n\nexport { WaterShader }\n","import { Mesh, OrthographicCamera, PlaneBufferGeometry, Scene, ShaderMaterial, UniformsUtils, Vector2 } from 'three'\nimport { WaterShader } from '../shaders/WaterShader.js'\nimport { Pass } from 'three/examples/jsm/postprocessing/Pass'\n\nvar WaterPass = function (dt_size) {\n  Pass.call(this)\n  if (WaterShader === undefined) console.error('THREE.WaterPass relies on THREE.WaterShader')\n  var shader = WaterShader\n  this.uniforms = UniformsUtils.clone(shader.uniforms)\n  if (dt_size === undefined) dt_size = 64\n  this.uniforms['resolution'].value = new Vector2(dt_size, dt_size)\n  this.material = new ShaderMaterial({\n    uniforms: this.uniforms,\n    vertexShader: shader.vertexShader,\n    fragmentShader: shader.fragmentShader,\n  })\n  this.camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1)\n  this.scene = new Scene()\n  this.quad = new Mesh(new PlaneBufferGeometry(2, 2), null)\n  this.quad.frustumCulled = false // Avoid getting clipped\n  this.scene.add(this.quad)\n  this.factor = 0\n  this.time = 0\n}\n\nWaterPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: WaterPass,\n\n  render: function (renderer, writeBuffer, readBuffer, deltaTime, maskActive) {\n    const factor = Math.max(0, this.factor)\n    this.uniforms['byp'].value = factor ? 0 : 1\n    this.uniforms['tex'].value = readBuffer.texture\n    this.uniforms['time'].value = this.time\n    this.uniforms['factor'].value = this.factor\n    this.time += 0.05\n    this.quad.material = this.material\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null)\n      renderer.render(this.scene, this.camera)\n    } else {\n      renderer.setRenderTarget(writeBuffer)\n      if (this.clear) renderer.clear()\n      renderer.render(this.scene, this.camera)\n    }\n  },\n})\n\nexport { WaterPass }\n","export function getMousePos(e) {\n  return { x: e.clientX, y: e.clientY }\n}\nexport function getMouseDegrees(x, y, degreeLimit) {\n  let dx = 0,\n    dy = 0,\n    xdiff,\n    xPercentage,\n    ydiff,\n    yPercentage\n\n  let w = { x: window.innerWidth, y: window.innerHeight }\n\n  // Left (Rotates neck left between 0 and -degreeLimit)\n  // 1. If cursor is in the left half of screen\n  if (x <= w.x / 2) {\n    // 2. Get the difference between middle of screen and cursor position\n    xdiff = w.x / 2 - x\n    // 3. Find the percentage of that difference (percentage toward edge of screen)\n    xPercentage = (xdiff / (w.x / 2)) * 100\n    // 4. Convert that to a percentage of the maximum rotation we allow for the neck\n    dx = ((degreeLimit * xPercentage) / 100) * -1\n  }\n\n  // Right (Rotates neck right between 0 and degreeLimit)\n  if (x >= w.x / 2) {\n    xdiff = x - w.x / 2\n    xPercentage = (xdiff / (w.x / 2)) * 100\n    dx = (degreeLimit * xPercentage) / 100\n  }\n  // Up (Rotates neck up between 0 and -degreeLimit)\n  if (y <= w.y / 2) {\n    ydiff = w.y / 2 - y\n    yPercentage = (ydiff / (w.y / 2)) * 100\n    // Note that I cut degreeLimit in half when she looks up\n    dy = ((degreeLimit * 0.5 * yPercentage) / 100) * -1\n  }\n  // Down (Rotates neck down between 0 and degreeLimit)\n  if (y >= w.y / 2) {\n    ydiff = y - w.y / 2\n    yPercentage = (ydiff / (w.y / 2)) * 100\n    dy = (degreeLimit * yPercentage) / 100\n  }\n  return { x: dx, y: dy }\n}\n","// Auto-generated by https://github.com/react-spring/gltfjsx\n\nimport * as THREE from \"three\"\nimport React, { useEffect, useRef, useState } from \"react\"\nimport { useLoader, useFrame } from \"react-three-fiber\"\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\"\nimport { getMouseDegrees } from \"./utils\"\n\nfunction moveJoint(mouse, joint, degreeLimit = 40) {\n  let degrees = getMouseDegrees(mouse.current.x, mouse.current.y, degreeLimit)\n  joint.rotation.xD = THREE.MathUtils.lerp(joint.rotation.xD || 0, degrees.y, 0.1)\n  joint.rotation.yD = THREE.MathUtils.lerp(joint.rotation.yD || 0, degrees.x, 0.1)\n  joint.rotation.x = THREE.Math.degToRad(joint.rotation.xD)\n  joint.rotation.y = THREE.Math.degToRad(joint.rotation.yD)\n}\n\nexport default function Model({ mouse, ...props }) {\n  const group = useRef()\n  const { nodes, animations } = useLoader(GLTFLoader, \"https://k0t0vich.github.io/demo/stacy.glb\")\n  const texture = useLoader(THREE.TextureLoader, \"https://k0t0vich.github.io/demo/tex.jpg\")\n\n  const actions = useRef()\n  const [mixer] = useState(() => new THREE.AnimationMixer())\n  useFrame((state, delta) => mixer.update(delta))\n  useEffect(() => {\n    actions.current = { idle: mixer.clipAction(animations[8], group.current) }\n    actions.current.idle.play()\n    return () => animations.forEach((clip) => mixer.uncacheClip(clip))\n  }, [])\n\n  useFrame((state, delta) => {\n    mixer.update(delta)\n    moveJoint(mouse, nodes.mixamorigNeck)\n    moveJoint(mouse, nodes.mixamorigSpine)\n  })\n\n  return (\n    <group ref={group} {...props} dispose={null}>\n      <group rotation={[Math.PI / 2, 0, 0]}>\n        <primitive object={nodes[\"mixamorigHips\"]} />\n        <skinnedMesh receiveShadow castShadoow geometry={nodes[\"stacy\"].geometry} skeleton={nodes[\"stacy\"].skeleton}>\n          <meshPhongMaterial map={texture} map-flipY={false} skinning={true}/>\n        </skinnedMesh>\n      </group>\n    </group>\n  )\n}\n","import * as THREE from 'three'\nimport React, { useState, useCallback, useEffect, useRef, useMemo, Suspense } from 'react'\nimport { Canvas, extend, useFrame, useThree } from 'react-three-fiber'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer'\nimport { ShaderPass } from 'three/examples/jsm/postprocessing/ShaderPass'\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass'\nimport { UnrealBloomPass } from 'three/examples/jsm/postprocessing/UnrealBloomPass'\nimport { FilmPass } from 'three/examples/jsm/postprocessing/FilmPass'\nimport { GlitchPass } from './../resources/postprocessing/GlitchPass'\nimport { WaterPass } from './../resources/postprocessing/WaterPass'\n\nimport Model from './Model'\nimport { getMousePos } from \"./utils\"\n\n// Makes these prototypes available as \"native\" jsx-string elements\nextend({ EffectComposer, ShaderPass, RenderPass, WaterPass, UnrealBloomPass, FilmPass, GlitchPass })\n\nconst halfPi = Math.PI/2;\n\nconst count = 200;\nconst maxZ = 50;\nconst minZ = 55; \n\nfunction Swarm({ count, mouse }) {\n  const mesh = useRef()\n  const light = useRef()\n  const { viewport } = useThree()\n  const aspect = viewport().factor\n  const dummy = useMemo(() => new THREE.Object3D(), [])\n\n  // Generate some random positions, speed factors and timings\n  const particles = useMemo(() => {\n    const temp = []\n    for (let i = 0; i < count; i++) {\n\n      const \n        r = Math.random() * 10 + 20 ,//радиус\n        angle = Math.random() * 6.28,\n        zLen = Math.random() * 2 + 0.1,\n        t = Math.random() * halfPi,\n        speed = 0.02 + Math.random() / 100,\n        x = -Math.sin(angle) * r,\n        y = Math.cos(angle) * r\n\n      temp.push({r, t, speed, x, y, zLen});\n    }\n    return temp\n  }, [count])\n\n  useFrame((state) => {\n    particles.forEach((particle, i) => {\n      let { r, t, speed, x, y, zLen } = particle;\n \n      t = particle.t += speed;\n      if (t > halfPi) t = particle.t = 0;\n\n      const z = -maxZ * Math.sin(t) + minZ;\n\n      dummy.position.set(x, y, z);\n      dummy.scale.set(1, 1, zLen)\n      dummy.updateMatrix()\n      mesh.current.setMatrixAt(i, dummy.matrix);\n    })\n    mesh.current.instanceMatrix.needsUpdate = true\n  })\n  return (\n    <>\n\n      <instancedMesh ref={mesh} args={[null, null, count]}>\n        <boxGeometry attach=\"geometry\" args={[0.01, 0.5, 10]} />\n        <meshStandardMaterial attach=\"material\" color={Math.random() * 0xffffff} roughness={0.5} metalness={0.5} />\n      </instancedMesh>\n    </>\n  )\n}\n\nfunction Effect({ down }) {\n  const composer = useRef()\n  const { scene, gl, size, camera } = useThree();\n  if (down) {\n    camera.position.x = 0;\n    camera.position.y = 0;\n    camera.rotation.x = 0.3;\n\n  } else {\n    camera.position.x = -15;\n    camera.position.y = 0;\n    camera.rotation.x = 0;\n  }\n  const aspect = useMemo(() => new THREE.Vector2(size.width, size.height), [size])\n  useEffect(() => void composer.current.setSize(size.width, size.height), [size])\n  useFrame(() => composer.current.render(), 1)\n  return (\n    <effectComposer ref={composer} args={[gl]}>\n      <renderPass attachArray=\"passes\" scene={scene} camera={camera} />\n      <waterPass attachArray=\"passes\" factor={down ? 0 : 0}/>\n      <unrealBloomPass attachArray=\"passes\" args={[aspect, 2, 1, 0]} />\n      <filmPass attachArray=\"passes\" factor={down ? 1 : 0} args={[0.25, 0.4, 1500, false]} />\n      <glitchPass attachArray=\"passes\" factor={down ? 1 : 0} />\n    </effectComposer>\n  )\n}\n\nexport default function App() {\n  const [down, set] = useState(false)\n  const mouse = useRef({x: 0, y: 0})\n  const onMouseMove = useCallback(\n    ({ clientX: x, clientY: y }) => (mouse.current = [x - window.innerWidth / 2, y - window.innerHeight / 2]),\n    []\n  )\n  return (\n    <div\n      style={{ width: '100%', height: '100%' }}\n      onMouseMove={(e) => (mouse.current = getMousePos(e))}\n      onMouseUp={() => set(false)}\n      onMouseDown={() => set(true)}\n    >\n      <Canvas camera={{ fov: 100, position: [0, 0, 50]}}>\n        <ambientLight intensity={1} />\n        <pointLight distance={60} intensity={1} color=\"white\" />\n        <Swarm mouse={mouse} count={count} />\n        <Suspense fallback = {null}>\n          <Model mouse={mouse} position={[0, -30, 20]} scale={[0.2, 0.2, 0.2]}/>\n        </Suspense>\n        \n        <Effect down={down} />\n      </Canvas>\n    </div>\n  )\n}\n","import styled, { createGlobalStyle } from 'styled-components'\n\nconst Page = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100vh;\n\n  & > h1 {\n    font-family: 'Roboto', sans-serif;\n    font-weight: 900;\n    font-size: 8em;\n    margin: 0;\n    color: white;\n    line-height: 0.59em;\n    letter-spacing: -2px;\n  }\n\n  @media only screen and (max-width: 1000px) {\n    & > h1 {\n      font-size: 5em;\n      letter-spacing: -1px;\n    }\n  }\n\n  & > a {\n    margin: 0;\n    color: white;\n    text-decoration: none;\n  }\n`\n\nconst Global = createGlobalStyle`\n  * {\n    box-sizing: border-box;\n  }\n\n  html,\n  body,\n  #root {\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    overflow: hidden;\n  }\n\n  #root {\n    overflow: auto;\n  }\n\n  body {\n    position: fixed;\n    overflow: hidden;\n    overscroll-behavior-y: none;\n    font-family: -apple-system, BlinkMacSystemFont, avenir next, avenir, helvetica neue, helvetica, ubuntu, roboto, noto, segoe ui, arial, sans-serif;\n    color: black;\n    background: white;\n  }\n`\n\nexport { Global, Page }\n","import React from 'react'\nimport Demo from './demo/Demo' \n// import Demo from './demos/dev/Lines' \nimport { Global } from './styles'\nimport { Page } from './styles'\n\nexport default function App() {\n  return (\n    <div>\n      <Global />\n      <Page>\n          <Demo/>\n      </Page>\n    </div>\n  )\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\n//import App from './App'\nimport App from './Demo'\n\n//ReactDOM.createRoot(document.getElementById('root')).render(<App />)\nReactDOM.render(<App />, document.getElementById('root'))\n","export * from '../index'\nexport * from '../canvas'\n\nimport { WebGLRenderer, WebGL1Renderer } from 'three'\nimport React, { useRef } from 'react'\nimport { ResizeContainer, ContainerProps } from './shared/web/ResizeContainer'\n\nexport * from './shared/web/ResizeContainer'\n\nexport const Canvas = React.memo(function Canvas({ children, ...props }: ContainerProps) {\n  const canvasRef = useRef<HTMLCanvasElement>()\n  const renderer = props.webgl1 ? WebGL1Renderer : WebGLRenderer\n  return (\n    <ResizeContainer\n      {...props}\n      renderer={() => {\n        if (canvasRef.current) {\n          const params = { antialias: true, alpha: true, ...props.gl }\n          const temp = new renderer({\n            powerPreference: 'high-performance',\n            //stencil: false,\n            //depth: false,\n            canvas: canvasRef.current,\n            ...params,\n          })\n          return temp\n        }\n      }}\n      preRender={<canvas ref={canvasRef as React.MutableRefObject<HTMLCanvasElement>} style={{ display: 'block' }} />}\n    >\n      {children}\n    </ResizeContainer>\n  )\n})\n","import * as THREE from 'three'\nimport React from 'react'\nimport Reconciler from 'react-reconciler'\n// @ts-ignore\n//import Reconciler from 'react-reconciler/cjs/react-reconciler.production.min'\nimport { unstable_now as now, unstable_IdlePriority as idlePriority, unstable_runWithPriority as run } from 'scheduler'\nimport { CanvasContext } from './canvas'\nimport { name, version } from '../package.json'\n\nexport type GlobalRenderCallback = (timeStamp: number) => boolean\n\nexport interface ObjectHash {\n  [name: string]: object\n}\n\nconst roots = new Map<THREE.Object3D, Reconciler.FiberRoot>()\n\nconst emptyObject = {}\nconst is = {\n  obj: (a: any) => a === Object(a) && !is.arr(a),\n  fun: (a: any) => typeof a === 'function',\n  str: (a: any) => typeof a === 'string',\n  num: (a: any) => typeof a === 'number',\n  und: (a: any) => a === void 0,\n  arr: (a: any) => Array.isArray(a),\n  equ(a: any, b: any) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false\n    // Atomic, just compare a against b\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b\n    // Array, shallow compare first to see if it's a match\n    if (is.arr(a) && a == b) return true\n    // Last resort, go through keys\n    let i\n    for (i in a) if (!(i in b)) return false\n    for (i in b) if (a[i] !== b[i]) return false\n    return is.und(i) ? a === b : true\n  },\n}\n\nfunction createSubs(callback: GlobalRenderCallback, subs: GlobalRenderCallback[]): () => void {\n  const index = subs.length\n  subs.push(callback)\n  return () => void subs.splice(index, 1)\n}\n\nlet globalEffects: GlobalRenderCallback[] = []\nlet globalAfterEffects: GlobalRenderCallback[] = []\nlet globalTailEffects: GlobalRenderCallback[] = []\nexport const addEffect = (callback: GlobalRenderCallback) => createSubs(callback, globalEffects)\nexport const addAfterEffect = (callback: GlobalRenderCallback) => createSubs(callback, globalAfterEffects)\nexport const addTail = (callback: GlobalRenderCallback) => createSubs(callback, globalTailEffects)\n\nexport function renderGl(\n  state: React.MutableRefObject<CanvasContext>,\n  timestamp: number,\n  repeat = 0,\n  runGlobalEffects = false\n) {\n  let i\n  // Run global effects\n  if (runGlobalEffects) {\n    for (i = 0; i < globalEffects.length; i++) {\n      globalEffects[i](timestamp)\n      repeat++\n    }\n  }\n\n  // Run local effects\n  const delta = state.current.clock.getDelta()\n\n  for (i = 0; i < state.current.subscribers.length; i++) {\n    state.current.subscribers[i].ref.current(state.current, delta)\n  }\n\n  // Decrease frame count\n  state.current.frames = Math.max(0, state.current.frames - 1)\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames\n  // Render content\n  if (!state.current.manual && state.current.gl.render)\n    state.current.gl.render(state.current.scene, state.current.camera)\n\n  // Run global after-effects\n  if (runGlobalEffects) {\n    for (i = 0; i < globalAfterEffects.length; i++) {\n      globalAfterEffects[i](timestamp)\n    }\n  }\n\n  return repeat\n}\n\nlet running = false\nfunction renderLoop(timestamp: number) {\n  running = true\n\n  let repeat = 0\n  let i\n  // Run global effects\n  for (i = 0; i < globalEffects.length; i++) {\n    globalEffects[i](timestamp)\n    repeat++\n  }\n\n  roots.forEach((root) => {\n    const state = root.containerInfo.__state\n    // If the frameloop is invalidated, do not run another frame\n    if (\n      state.current.active &&\n      state.current.ready &&\n      (!state.current.invalidateFrameloop || state.current.frames > 0)\n    ) {\n      repeat = renderGl(state, timestamp, repeat)\n    }\n  })\n\n  // Run global after-effects\n  for (i = 0; i < globalAfterEffects.length; i++) {\n    globalAfterEffects[i](timestamp)\n  }\n\n  if (repeat !== 0) {\n    return requestAnimationFrame(renderLoop)\n  } else {\n    // Tail call effects, they are called when rendering stops\n    for (i = 0; i < globalTailEffects.length; i++) {\n      globalTailEffects[i](timestamp)\n    }\n  }\n  // Flag end of operation\n  running = false\n}\n\nexport function invalidate(state: React.MutableRefObject<CanvasContext> | boolean = true, frames = 2) {\n  if (state === true) {\n    roots.forEach((root) => (root.containerInfo.__state.current.frames = frames))\n  } else if (state && state.current) {\n    if (state.current.vr) return\n    state.current.frames = frames\n  }\n  if (!running) {\n    running = true\n    requestAnimationFrame(renderLoop)\n  }\n}\n\nexport function forceResize() {\n  roots.forEach((root) => root.containerInfo.__state.current.forceResize())\n}\n\nlet catalogue: ObjectHash = {}\nexport const extend = (objects: object): void => void (catalogue = { ...catalogue, ...objects })\n\nexport function applyProps(instance: any, newProps: any, oldProps: any = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container\n\n  const sameProps = [] as string[]\n  const handlers = [] as string[]\n\n  let i\n  let keys = Object.keys(newProps)\n\n  for (i = 0; i < keys.length; i++) {\n    if (is.equ(newProps[keys[i]], oldProps[keys[i]])) {\n      sameProps.push(keys[i])\n    }\n\n    // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n    if (is.fun(newProps[keys[i]]) && keys[i].startsWith('on')) {\n      if (\n        keys[i].includes('Pointer') ||\n        keys[i].includes('Click') ||\n        keys[i].includes('ContextMenu') ||\n        keys[i].includes('Wheel')\n      ) {\n        handlers.push(keys[i])\n      }\n    }\n  }\n\n  const leftOvers = [] as string[]\n  keys = Object.keys(oldProps)\n  if (accumulative) {\n    for (i = 0; i < keys.length; i++) {\n      if (newProps[keys[i]] === void 0) {\n        leftOvers.push(keys[i])\n      }\n    }\n  }\n\n  const toFilter = [...sameProps, 'children', 'key', 'ref']\n  // Instances use \"object\" as a reserved identifier\n  if (instance.__instance) toFilter.push('object')\n  const filteredProps = { ...newProps }\n\n  // Removes sameProps and reserved props from newProps\n  keys = Object.keys(filteredProps)\n  for (i = 0; i < keys.length; i++) {\n    if (toFilter.indexOf(keys[i]) > -1) {\n      delete filteredProps[keys[i]]\n    }\n  }\n\n  // Add left-overs as undefined props so they can be removed\n  keys = Object.keys(leftOvers)\n  for (i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'children') {\n      filteredProps[keys[i]] = undefined\n    }\n  }\n\n  const filteredPropsEntries = Object.entries(filteredProps)\n  if (filteredPropsEntries.length > 0) {\n    filteredPropsEntries.forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        let root = instance\n        let target = root[key]\n        if (key.includes('-')) {\n          const entries = key.split('-')\n          target = entries.reduce((acc, key) => acc[key], instance)\n          // If the target is atomic, it forces us to switch the root\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse()\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance)\n            key = name\n          }\n        }\n        // Special treatment for objects with support for set/copy\n        const isColorManagement = instance.__container?.__state?.current.colorManagement\n        if (target && target.set && (target.copy || target instanceof THREE.Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) {\n            target.set(...value)\n          }\n          // Test again target.copy(class) next ...\n          else if (\n            target.copy &&\n            value &&\n            (value as any).constructor &&\n            target.constructor.name === (value as any).constructor.name\n          ) {\n            target.copy(value)\n          }\n          // If nothing else fits, just set the single value, ignore undefined\n          // https://github.com/react-spring/react-three-fiber/issues/274\n          else if (value !== undefined) {\n            target.set(value)\n\n            // Auto-convert sRGB colors, for now ...\n            // https://github.com/react-spring/react-three-fiber/issues/344\n            if (isColorManagement && target instanceof THREE.Color) {\n              target.convertSRGBToLinear()\n            }\n          }\n          // Else, just overwrite the value\n        } else {\n          root[key] = value\n\n          // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n          if (isColorManagement && root[key] instanceof THREE.Texture) {\n            root[key].encoding = THREE.sRGBEncoding\n          }\n        }\n\n        invalidateInstance(instance)\n      }\n    })\n\n    // Preemptively delete the instance from the containers interaction\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined\n      const index = container.__interaction.indexOf(instance)\n      if (index > -1) container.__interaction.splice(index, 1)\n    }\n\n    // Prep interaction handlers\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) container.__interaction.push(instance)\n      // Add handlers to the instances handler-map\n      instance.__handlers = handlers.reduce((acc, key) => {\n        acc[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key]\n        return acc\n      }, {} as { [key: string]: any })\n    }\n    // Call the update lifecycle when it is being updated, but only when it is part of the scene\n    if (instance.parent) updateInstance(instance)\n  }\n}\n\nfunction invalidateInstance(instance: any) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state)\n}\n\nfunction updateInstance(instance: any) {\n  if (instance.onUpdate) instance.onUpdate(instance)\n}\n\nfunction createInstance(\n  type: string,\n  { args = [], ...props },\n  container: THREE.Object3D,\n  hostContext: any,\n  internalInstanceHandle: Reconciler.Fiber\n) {\n  let name = `${type[0].toUpperCase()}${type.slice(1)}`\n  let instance\n  if (type === 'primitive') {\n    // Switch off dispose for primitive objects\n    props = { dispose: null, ...props }\n    instance = props.object\n    instance.__instance = true\n    instance.__dispose = instance.dispose\n  } else {\n    const target = (catalogue as any)[name] || (THREE as any)[name]\n\n    if (!target) {\n      throw `\"${name}\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/react-spring/react-three-fiber/blob/master/api.md#putting-already-existing-objects-into-the-scene-graph`\n    }\n\n    instance = is.arr(args) ? new target(...args) : new target(args)\n  }\n\n  // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n  while ((container as any).__container) {\n    container = (container as any).__container\n  }\n\n  // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n  if (!roots.has(container)) {\n    const fn = (node: Reconciler.Fiber): THREE.Object3D => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo\n      else return fn(node.return)\n    }\n    container = fn(internalInstanceHandle)\n  }\n\n  // Apply initial props\n  instance.__objects = []\n  instance.__container = container\n\n  // Auto-attach geometries and materials\n  if (name.endsWith('Geometry')) {\n    props = { attach: 'geometry', ...props }\n  } else if (name.endsWith('Material')) {\n    props = { attach: 'material', ...props }\n  }\n\n  // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n  applyProps(instance, props, {})\n  return instance\n}\n\nfunction appendChild(parentInstance: any, child: any) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.add(child)\n    } else {\n      parentInstance.__objects.push(child)\n      child.parent = parentInstance\n      // The attach attribute implies that the object attaches itself on the parent\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = []\n        parentInstance[child.attachArray].push(child)\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {}\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child\n      } else if (child.attach) {\n        parentInstance[child.attach] = child\n      }\n    }\n    updateInstance(child)\n    invalidateInstance(child)\n  }\n}\n\nfunction insertBefore(parentInstance: any, child: any, beforeChild: any) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance\n      child.dispatchEvent({ type: 'added' })\n      const restSiblings = parentInstance.children.filter((sibling: any) => sibling !== child)\n      // TODO: the order is out of whack if data objects are present, has to be recalculated\n      const index = restSiblings.indexOf(beforeChild)\n      parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)]\n      updateInstance(child)\n    } else {\n      appendChild(parentInstance, child)\n    } // TODO: order!!!\n    invalidateInstance(child)\n  }\n}\n\nfunction removeRecursive(array: any, parent: any, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array\n    target.forEach((child: any) => removeChild(parent, child))\n  }\n}\n\nfunction removeChild(parentInstance: any, child: any) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child)\n    } else {\n      child.parent = null\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter((x: any) => x !== child)\n      // Remove attachment\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter((x: any) => x !== child)\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]]\n      } else if (child.attach) {\n        parentInstance[child.attach] = null\n      }\n    }\n    invalidateInstance(child)\n\n    // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n    if (child.dispose !== null) {\n      run(idlePriority, () => {\n        // Remove interactivity\n        if (child.__container) {\n          child.__container.__interaction = child.__container.__interaction.filter((x: any) => x !== child)\n        }\n        // Remove nested child objects\n        removeRecursive(child.__objects, child)\n        removeRecursive(child.children, child, true)\n        // Dispose item\n        if (child.dispose) child.dispose()\n        else if (child.__dispose) child.__dispose()\n        // Remove references\n        delete child.__container\n        delete child.__objects\n      })\n    }\n  }\n}\n\nfunction switchInstance(instance: any, type: string, newProps: any, fiber: Reconciler.Fiber) {\n  const parent = instance.parent\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber)\n  removeChild(parent, instance)\n  appendChild(parent, newInstance)\n  // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;[fiber, fiber.alternate].forEach((fiber: any) => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance)\n        else (fiber.ref as Reconciler.RefObject).current = newInstance\n      }\n    }\n  })\n}\n\nconst Renderer = Reconciler({\n  now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  // @ts-ignore\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate(instance: any, updatePayload: any, type: string, oldProps: any, newProps: any, fiber: Reconciler.Fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber)\n    } else {\n      // This is a data object, let's extract critical information about it\n      const { args: argsNew = [], ...restNew } = newProps\n      const { args: argsOld = [], ...restOld } = oldProps\n      // If it has new props or arguments, then it needs to be re-instanciated\n      const hasNewArgs = argsNew.some((value: any, index: number) =>\n        is.obj(value)\n          ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key])\n          : value !== argsOld[index]\n      )\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber)\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true)\n      }\n    }\n  },\n  hideInstance(instance: any) {\n    if (instance.isObject3D) {\n      instance.visible = false\n      invalidateInstance(instance)\n    }\n  },\n  unhideInstance(instance: any, props: any) {\n    if ((instance.isObject3D && props.visible == null) || props.visible) {\n      instance.visible = true\n      invalidateInstance(instance)\n    }\n  },\n  hideTextInstance() {\n    throw new Error(\n      'Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.'\n    )\n  },\n  getPublicInstance(instance: any) {\n    return instance\n  },\n  getRootHostContext() {\n    return emptyObject\n  },\n  getChildHostContext() {\n    return emptyObject\n  },\n  createTextInstance() {},\n  finalizeInitialChildren() {\n    return false\n  },\n  prepareUpdate() {\n    return emptyObject\n  },\n  shouldDeprioritizeSubtree() {\n    return false\n  },\n  prepareForCommit() {\n    return null\n  },\n  preparePortalMount() {\n    return null\n  },\n  resetAfterCommit() {},\n  shouldSetTextContent() {\n    return false\n  },\n  clearContainer() {\n    return false\n  },\n})\n\nconst hasSymbol = is.fun(Symbol) && Symbol.for\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca\n\nexport function render(\n  element: React.ReactNode,\n  container: THREE.Object3D,\n  state?: React.MutableRefObject<CanvasContext>\n) {\n  let root = roots.get(container)\n  if (!root) {\n    ;(container as any).__state = state\n    // @ts-ignore\n    let newRoot = (root = Renderer.createContainer(\n      container,\n      state !== undefined && state.current.concurrent ? 2 : 0,\n      false,\n      // @ts-ignore\n      null\n    ))\n    roots.set(container, newRoot)\n  }\n  Renderer.updateContainer(element, root, null, () => undefined)\n  return Renderer.getPublicRootInstance(root)\n}\n\nexport function unmountComponentAtNode(container: THREE.Object3D, callback?: (c: THREE.Object3D) => void) {\n  const root = roots.get(container)\n  if (root) {\n    Renderer.updateContainer(null, root, null, () => {\n      roots.delete(container)\n      if (callback) callback(container)\n    })\n  }\n}\n\nexport function createPortal(children: React.ReactNode, containerInfo: any, implementation?: any, key: any = null) {\n  if (!containerInfo.__objects) containerInfo.__objects = []\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation,\n  }\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  //@ts-ignore\n  findHostInstanceByFiber: () => null,\n  version: version,\n  rendererPackageName: name,\n})\n\nexport { Renderer }\n"],"sourceRoot":""}